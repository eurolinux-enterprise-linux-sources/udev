diff -up udev-147/libudev/libudev-enumerate.c.realloc udev-147/libudev/libudev-enumerate.c
--- udev-147/libudev/libudev-enumerate.c.realloc	2013-10-11 12:51:13.121225840 +0200
+++ udev-147/libudev/libudev-enumerate.c	2013-10-11 12:51:51.328201367 +0200
@@ -249,8 +249,9 @@ struct udev_list_entry *udev_enumerate_g
 		return NULL;
 	if (!udev_enumerate->devices_uptodate) {
 		unsigned int i;
+		int move_later = -1;
 		unsigned int max;
-		struct syspath *prev = NULL, *move_later = NULL;
+		struct syspath *prev = NULL;
 
 		udev_list_cleanup_entries(udev_enumerate->udev, &udev_enumerate->devices_list);
 		qsort(udev_enumerate->devices, udev_enumerate->devices_cur, sizeof(struct syspath), syspath_cmp);
@@ -279,30 +280,30 @@ struct udev_list_entry *udev_enumerate_g
 			/* skip to be delayed devices, and move the to
 			 * the point where the prefix changes. We can
 			 * only move one item at a time. */
-			if (!move_later) {
+			if (move_later < 0) {
 				move_later_prefix = devices_delay_later(udev_enumerate->udev, entry->syspath);
 
 				if (move_later_prefix > 0) {
-					move_later = entry;
+					move_later = i;
 					continue;
 				}
 			}
 
-			if (move_later &&
-			    strncmp(entry->syspath, move_later->syspath, move_later_prefix) != 0) {
+			if ((move_later >=0) &&
+			    strncmp(entry->syspath, udev_enumerate->devices[move_later].syspath, move_later_prefix) != 0) {
 
 				udev_list_entry_add(udev_enumerate->udev, &udev_enumerate->devices_list,
-					    move_later->syspath, NULL, 0, 0);
-				move_later = NULL;
+					    udev_enumerate->devices[move_later].syspath, NULL, 0, 0);
+				move_later = -1;
 			}
 
 			udev_list_entry_add(udev_enumerate->udev, &udev_enumerate->devices_list,
 					    entry->syspath, NULL, 0, 0);
 		}
 
-		if (move_later)
+		if (move_later>=0)
 			udev_list_entry_add(udev_enumerate->udev, &udev_enumerate->devices_list,
-					    move_later->syspath, NULL, 0, 0);
+					    udev_enumerate->devices[move_later].syspath, NULL, 0, 0);
 
 		/* add and cleanup delayed devices from end of list */
 		for (i = max; i < udev_enumerate->devices_cur; i++) {
