From 51b924cfcb179430a10e00fdaf18353f140a1c71 Mon Sep 17 00:00:00 2001
From: Michal Sekletar <msekleta@redhat.com>
Date: Mon, 29 Feb 2016 09:23:51 +0100
Subject: [PATCH] Revert "udev: fibre channel: add support to NPIV FC virtual
 interfaces."

This reverts commit 1c6c3e2ae16a1b5c854e765232bf6192d658b6ef.

Related: #1032218
---
 extras/path_id/path_id.c | 32 ++++++--------------------------
 1 file changed, 6 insertions(+), 26 deletions(-)

diff --git a/extras/path_id/path_id.c b/extras/path_id/path_id.c
index 4fd06bc..4ce79df 100644
--- a/extras/path_id/path_id.c
+++ b/extras/path_id/path_id.c
@@ -110,38 +110,17 @@ static struct udev_device *handle_scsi_fibre_channel(struct udev_device *parent,
 {
 	struct udev *udev  = udev_device_get_udev(parent);
 	struct udev_device *targetdev;
-	struct udev_device *rportdev;
-	struct udev_device *hostdev;
-	struct udev_device *vportdev;
 	struct udev_device *fcdev = NULL;
 	const char *port;
-	char *lun = NULL;
+	char *lun = NULL;;
 
 	targetdev = udev_device_get_parent_with_subsystem_devtype(parent, "scsi", "scsi_target");
 	if (targetdev == NULL)
 		return NULL;
 
-	rportdev = udev_device_get_parent(targetdev);
-	if (rportdev == NULL)
-		goto skip_npiv_check;
-
-	hostdev = udev_device_get_parent(rportdev);
-	if (hostdev == NULL)
-		goto skip_npiv_check;
-
-	vportdev = udev_device_get_parent(hostdev);
-	if (vportdev == NULL)
-		goto skip_npiv_check;
-
-	fcdev = udev_device_new_from_subsystem_sysname(udev, "fc_vports", udev_device_get_sysname(vportdev));
-
-skip_npiv_check:
-	if (!fcdev) {
-		fcdev = udev_device_new_from_subsystem_sysname(udev, "fc_transport", udev_device_get_sysname(targetdev));
-		if (fcdev == NULL)
-			return NULL;
-	}
-
+	fcdev = udev_device_new_from_subsystem_sysname(udev, "fc_transport", udev_device_get_sysname(targetdev));
+	if (fcdev == NULL)
+		return NULL;
 	port = udev_device_get_sysattr_value(fcdev, "port_name");
 	if (port == NULL) {
 		parent = NULL;
@@ -150,7 +129,8 @@ skip_npiv_check:
 
 	format_lun_number(parent, &lun);
 	path_prepend(path, "fc-%s-%s", port, lun);
-	free(lun);
+	if (lun)
+		free(lun);
 out:
 	udev_device_unref(fcdev);
 	return parent;
-- 
2.5.0

