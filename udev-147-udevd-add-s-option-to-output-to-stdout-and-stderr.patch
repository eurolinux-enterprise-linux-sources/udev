From 1647f06ce00a66472c6f09e8189b4f94228d8e26 Mon Sep 17 00:00:00 2001
From: RH udev team <udev-maint@redhat.com>
Date: Fri, 26 Jul 2013 19:25:54 +0200
Subject: [PATCH] udevd: add -s option to output to stdout and stderr

---
 udev/udevd.c | 14 +++++++++-----
 1 file changed, 9 insertions(+), 5 deletions(-)

diff --git a/udev/udevd.c b/udev/udevd.c
index 1c41add..a5b7abb 100644
--- a/udev/udevd.c
+++ b/udev/udevd.c
@@ -806,8 +806,9 @@ int main(int argc, char *argv[])
 	int fd;
 	sigset_t mask;
 	const char *value;
-	int daemonize = false;
-	int resolve_names = 1;
+        int daemonize = false;
+        int stdout_output = false;
+        int resolve_names = 1;
 	static const struct option options[] = {
 		{ "daemon", no_argument, NULL, 'd' },
 		{ "debug-trace", no_argument, NULL, 't' },
@@ -832,7 +833,7 @@ int main(int argc, char *argv[])
 	while (1) {
 		int option;
 
-		option = getopt_long(argc, argv, "dDthV", options, NULL);
+                option = getopt_long(argc, argv, "sdDthV", options, NULL);
 		if (option == -1)
 			break;
 
@@ -843,7 +844,10 @@ int main(int argc, char *argv[])
 		case 't':
 			debug_trace = true;
 			break;
-		case 'D':
+                case 's':
+                        stdout_output = true;
+                        break;
+                case 'D':
 			debug = true;
 			if (udev_get_log_priority(udev) < LOG_INFO)
 				udev_set_log_priority(udev, LOG_INFO);
@@ -1001,7 +1005,7 @@ int main(int argc, char *argv[])
 	startup_log(udev);
 
 	/* redirect std{out,err} */
-	if (!debug && !debug_trace) {
+        if (!debug && !debug_trace && !stdout_output) {
 		dup2(fd, STDIN_FILENO);
 		dup2(fd, STDOUT_FILENO);
 		dup2(fd, STDERR_FILENO);
-- 
1.8.3.1

